<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/dashboard.css"> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <title>Dashboard</title>
</head>
<body>
    <h1>Dashboard</h1>
    <!-- <form action=""> </form> -->
    <div class="info-continer">
        <div class="info">
            <h3>Number of connected Clients</h3>
            <h2 id="numOfClients">0</h2>
        </div>
        <div class="info">
            <h3>Number of adverties</h3>
            <h2 id="numOfAdvs">0</h2>
        </div>
    </div>
    <div class="SelectMode">
        <button id="OverAll">OverAll</button>
        <button id="Clients">Clients</button>
    </div>
    <div class="priview-continer hide" id="priview-continer">
        <div class="control">
            <div class = "control-container">
                <select name="Adv" id="advSelect" onchange="selectAdvOption()">
                    <option disabled selected value> -- select an advertie -- </option>
                </select> 
                <div class="buttons">
                    <button id="add">Add</button>
                    <button id="edit">Edit</button>
                    <button id="delete">Delete</button>
                </div> 
            </div>

            <div class="addNewAdv hide" id="addNewAdv">
                <div class="addNewAdv-input">
                    <input type="text" class="addLine" id= "addTitle" placeholder="title">
                    <input type="text" class="addLine" id= "addLine1" placeholder="line 1">
                    <input type="text" class="addLine" id= "addLine2" placeholder="line 2">
                    <input type="text" class="addLine" id= "addLine3" placeholder="line 3">
                    <input type="text" class="addLine" id= "addLine4" placeholder="line 4">
                    <input type="text" id="addImage" placeholder="image src">
                </div>
                <button type="submit" id="addButton">Add New Advertie</button>
            </div>

            <div class="editAdv hide" id="editAdv">
                <div class="editAdv-input">
                    <input type="text" class="editLine" id="editTitle" placeholder="title">
                    <input type="text" class="editLine" id="editLine1" placeholder="line 1">
                    <input type="text" class="editLine" id="editLine2" placeholder="line 2">
                    <input type="text" class="editLine" id="editLine3" placeholder="line 3">
                    <input type="text" class="editLine" id="editLine4" placeholder="line 4">
                    <input type="text" id="editImage" placeholder="image src">
                </div>
                <button type="submit" id="editButton">Save</button>
            </div>
        </div>
        <div class="displayAdv">
            <div class="data">
                <h2 id="line1"></h2>
                <h2 id="line2"></h2>
                <h2 id="line3"></h2>
                <h2 id="line4"></h2>
            </div>  
            <div class="continer_img">
                <img id="myImg" src="#"/>
            </div>
        </div>
    </div>

    <div class="clients hide" id="client"> 
        <!-- <label> Please choose client: </label> -->
        <div class="clients-top">
            <select name="clientChoose" id="clientChoose" onchange="chooseScreen()">
                <option disabled selected value> -- select a screen -- </option>
                <option id="screen1" value="0"> screen 1 </option>
                <option id="screen2" value="1"> screen 2 </option>
                <option id="screen3" value="2"> screen 3 </option>
            </select>
            <div class="clients-toScreen" id="clients-toScreen">
                <button id="addAdvToScreen"> add Adv to screen </button> 
                <button id="deleteAdvFromScreen"> delete Adv from screen </button>
            </div>
        </div>
        <div class="divForAddToScreen hide" id="divForAddToScreen"> 
            <select name="addAdvToScreen" id="addAdvToScreenSelect" onchange="addAdvSelect()" >
                <option disabled selected value> -- select adv -- </option>
            </select>
            <input type="text" placeholder="Duration Time" id="durationTimeAdd">
            <button id="saveBtnAdvToScreen"> save </button>
        </div>
        <div class="divForDeleteToScreen hide" id="divForDeleteToScreen"> 
            <select name="deleteAdvFromScreen" id="deleteAdvFromScreenSelect">
                <option disabled selected value> -- select adv -- </option>
            </select>
            <button id="deleteBtnAdvFromSceeen"> delete </button>
        </div>
    </div>
</body>
</html>

<script src='/socket.io/socket.io.js'></script>
<script>

    const socket = io.connect('http://localhost:8080');

    /* *********************** Information of numClients and numAdvs *********************** */
   
    const numOfAdvs = document.getElementById("numOfAdvs");
    const numOfClients = document.getElementById("numOfClients");

    socket.on("getInfoForAdmin",function(info){
        numOfClients.innerHTML = info[0];
        numOfAdvs.innerHTML = info[1];
    });

    var allAdvs; 

    socket.on("getAllAdvs", function(alladvs){
        allAdvs = alladvs;
    });


    /* *********************** Information from lines (from the client) *********************** */

    const addlines = document.querySelectorAll(".addLine");
    const editLines = document.querySelectorAll(".editLine");

    /* *********************** buttons *********************** */ 

    const addBtn = document.getElementById("addButton");
    const editBtn = document.getElementById("editButton");
    const deleteButton = document.getElementById("delete");
    const addButton  = document.getElementById("add");
    const editButton  = document.getElementById("edit");
    const addToScreen = document.getElementById("saveBtnAdvToScreen");
    const deleteToScreen = document.getElementById("deleteBtnAdvFromSceeen");
    const clientsBtn = document.getElementById("Clients");
    const add = document.querySelector("#addNewAdv");
    const edit = document.querySelector("#editAdv");
    const overAllBtn = document.querySelector("#OverAll");
    const overAll = document.querySelector("#priview-continer");
    const client = document.querySelector("#client");
    const toScreen = document.querySelector("#clients-toScreen");
    const addAdvToScreen = document.querySelector("#addAdvToScreen");
    const deleteAdvFromScreen = document.querySelector("#deleteAdvFromScreen");
    const divForAddToScreen = document.querySelector("#divForAddToScreen");
    const divForDeleteToScreen = document.querySelector("#divForDeleteToScreen");
    const addAdvToScreenSelect = document.querySelector("#addAdvToScreenSelect");
    const deleteAdvFromScreenSelect = document.querySelector("#deleteAdvFromScreenSelect");
    const durationTimeAdd = document.querySelector("#durationTimeAdd");


    deleteButton.disabled=true;
    editButton.disabled = true;
    addAdvToScreen.disabled = true;
    deleteAdvFromScreen.disabled = true;
    addToScreen.disabled = true;
    durationTimeAdd.disabled = true;
    

    addBtn.addEventListener("click",()=>{
        console.log("addBtn clicked");
        var arrAdd = creatInfoOfAdvInArray(addlines);
        cleanInputsAdd();
        socket.emit("newAdvData",arrAdd);
    });

    editBtn.addEventListener("click",()=> {

        console.log("editBtn clicked");
        var arrEdit = creatInfoOfAdvInArray(editLines);
        cleanInputsEdit();
        socket.emit("editAdvData",arrEdit);
    });

    addButton.addEventListener("click", ()=>{
        if(!edit.classList.contains("hide"))
            edit.classList.add("hide");
        add.classList.toggle("hide");
        console.log("addButton clicked");
    });

    editButton.addEventListener("click", ()=>{
        if(!add.classList.contains("hide"))
            add.classList.add("hide");
        edit.classList.toggle("hide");
        console.log("editButton clicked");
    });

    deleteButton.addEventListener("click", ()=>{
        
        console.log("deleteButton clicked");
        socket.emit("deleteAdv", idOfChoosenAdv);
    });

    addToScreen.addEventListener("click", ()=>{    
        console.log("addToScreen clicked");
        
    });

    deleteToScreen.addEventListener("click", ()=>{
        console.log("deleteToScreen clicked");
    });

    overAllBtn.addEventListener("click", ()=>{
        if(!client.classList.contains("hide"))
        client.classList.add("hide");
        overAll.classList.toggle("hide");
    });

    clientsBtn.addEventListener("click", ()=>{
        if(!overAll.classList.contains("hide"))
        overAll.classList.add("hide");
       client.classList.toggle("hide");
    });

    addAdvToScreen.addEventListener("click",()=>{
        if(!divForDeleteToScreen.classList.contains("hide"))
            divForDeleteToScreen.classList.add("hide");
        divForAddToScreen.classList.toggle("hide");
    });

    deleteAdvFromScreen.addEventListener("click",()=> {
        if(!divForAddToScreen.classList.contains("hide"))
            divForAddToScreen.classList.add("hide");
        divForDeleteToScreen.classList.toggle("hide");
    });

    /* ****************************** selectors names ****************************** */
    const selectAdv = document.getElementById("advSelect");
    const selectClient = document.getElementById("clientChoose");
    var currentScreen; 

    const addImage = document.getElementById("addImage");
   
    /* ****************************************************** */

    var idOfChoosenAdv;  // the id of the choosen  
    var advsArray; // all advs 
    var countAdvs = 0; 

    /* ****************************************************** */

    socket.on("sendAdv", function(allAdvs){
        var allAdv = [] 
        allAdv = allAdvs;
        advsArray = allAdv;

        countAdvs = advsArray[advsArray.length - 1].myId;
        // console.log("count ==== " + countAdvs);
        createOption(allAdvs,selectAdv);
    });

    selectAdv.addEventListener("load",createOption());  
    
    /* ************************************************ */

    function creatInfoOfAdvInArray(dlines){ // return an array with informatin from lines (from client).
        var dataLines = [];
        dlines.forEach((line)=>{
            // if(line.value !== "")
                dataLines.push(line.value);
        });
        if(addImage.value !== "" ){   // TODO: change!!!
            dataLines.push(addImage.value);
        }
        return dataLines;
    }

    function cleanInputsAdd(){
        addlines.forEach((line)=>{
            line.value = "";
        });
        addImage.value = "";
    }

    function cleanInputsEdit(){
        editLines.forEach((line)=>{
            line.value = "";
        });
        editImage.value = "";
    }
 
    function createOption(allAdvs,selectAdv){
        if(allAdvs !== undefined){
            allAdvs.forEach((adv)=> {
                var opt = document.createElement('option');
                opt.value = adv.myId;
                opt.innerHTML = adv.title;
                opt.classList.add("option");
                selectAdv.appendChild(opt);
            });
        }
    }

    /* ************************* functions of select ************************* */
    function selectAdvOption(){
        deleteButton.disabled=false;
        editButton.disabled = false;
        socket.emit("getSelectAdv",selectAdv.options[selectAdv.selectedIndex].value);
        idOfChoosenAdv = selectAdv.options[selectAdv.selectedIndex].value;
        socket.on("returnSelectedAdv",function(res){           
            displayAdv(res);
            displayEdit(res);
        }); 
    }

    function chooseScreen(){
        addAdvToScreen.disabled = false;
        deleteAdvFromScreen.disabled = false;
        currentScreen = selectClient.options[selectClient.selectedIndex].value;
        socket.emit("getAdvByScreen", currentScreen);
        socket.on("getArrayOfAdsToAdd",function(resToAddSelect){
            createOption(resToAddSelect,addAdvToScreenSelect)
        });
        socket.on("getArrayOfAdsToDelete",function(resToDeleteSelect){
            createOption(resToDeleteSelect,deleteAdvFromScreenSelect);
        });
    }

    /* ************************* displayes ************************* */
    function displayAdv(res){
        //document.getElementById("line1").style.color = allData[i].colors.line1color;
        //document.getElementById("line2").style.color = allData[i].colors.line2color;
        //document.getElementById("line3").style.color = allData[i].colors.line3color;
        //document.getElementById("line4").style.color = allData[i].colors.line4color;s
        // document.getElementById("title").innerHTML = res.text.title;
        document.getElementById("line1").innerHTML = res.text.line1;
        document.getElementById("line2").innerHTML = res.text.line2;
        document.getElementById("line3").innerHTML = res.text.line3;
        document.getElementById("line4").innerHTML = res.text.line4;
        document.getElementById("myImg").src = res.imgsrc;
        //document.getElementById("body").style.background = allData[i].colors.background;
    }
    
    function displayEdit(res){
        document.getElementById("editTitle").value = res.title;
        document.getElementById("editLine1").value = res.text.line1;
        document.getElementById("editLine2").value = res.text.line2;
        document.getElementById("editLine3").value = res.text.line3;
        document.getElementById("editLine4").value = res.text.line4;
        document.getElementById("editImage").value = res.imgsrc;
    }

    function addAdvSelect(){
        durationTimeAdd.disabled = false;
        durationTimeAdd.addEventListener("input",()=>{
            if(durationTimeAdd.value.length > 0)
                addToScreen.disabled = false;
            else
            addToScreen.disabled = true; 
        });
    }

</script>

